{
  "meta": {
    "project": "Osteo Consultation Management",
    "date": "2025-11-04",
    "prepared_by": "Generated by ChatGPT"
  },
  "product_overview": "This product focuses on stabilizing the consultation functionality within an osteopathy management application. It ensures reliable display, creation, and management of consultations, enhancing user experience with proper validations and error handling.",
  "core_goals": [
    "Stabilize and correct the data display for consultation lists and details.",
    "Implement reliable consultation creation with client and server-side validation.",
    "Provide a consistent and clear user experience in case of errors.",
    "Prevent regressions through comprehensive testing including unit and end-to-end tests.",
    "Ensure accessibility and localization of messages following ARIA standards."
  ],
  "key_features": [
    "Consultation list displaying date, time, patient, type, status, and summary, sorted by descending date.",
    "Detailed consultation view showing ID, patient, date/time, reasons, notes, treatment, practitioner, duration, and price with loading and error states.",
    "Consultation creation and editing form with search-enabled patient selection, input fields for date, time, duration, type, reason, notes, practitioner, and price.",
    "Client-side validation ensuring mandatory fields, valid dates/times, positive duration and non-negative price.",
    "Server-side validation with structured error responses displayed clearly in the UI.",
    "Navigation from list to detail views by clicking items.",
    "Accessibility-compliant messages, localizable for internationalization.",
    "Retry logic for limited network errors.",
    "Toast notifications for success and error feedback.",
    "Comprehensive unit tests for formatters, validators, and service errors.",
    "End-to-end tests for success scenarios and backend error handling."
  ],
  "user_flow_summary": [
    "User views the list of consultations, sorted by most recent, with key details visible.",
    "User selects a consultation to view its full details with proper loading and error states.",
    "User initiates creation of a new consultation via a form; inputs patient, date/time, duration, type, reason, notes, practitioner, and price.",
    "Client-side validations ensure no invalid or incomplete data is submitted.",
    "On submission, server validates data and returns success or structured errors.",
    "If errors occur, clear messages are displayed to user; successful creation redirects to detailed view with a confirmation toast.",
    "Users can retry actions when network errors occur, bounded by retry limits."
  ],
  "validation_criteria": [
    "Consultation list loads fully with correct sorting by descending date.",
    "Details view handles loading, error fallback, and displays correct consultation data.",
    "Client-side form validation prevents invalid submission (mandatory, valid dates, positive duration, and non-negative price).",
    "Server validation errors are mapped and clearly displayed in the UI.",
    "ARIA-compliant and localizable messages are used throughout the consultation features.",
    "Unit tests cover formatters, validators, and backend error handling.",
    "End-to-end tests validate successful creation and error handling workflows.",
    "API meets the defined contract endpoints and error formats as specified."
  ],
  "code_summary": {
    "tech_stack": [
      "TypeScript",
      "React (Vite)",
      "Firebase (Firestore, Storage)",
      "Cloud Functions (Node/TypeScript)",
      "TailwindCSS",
      "Vitest"
    ],
    "features": [
      {
        "name": "Authentification et contexte utilisateur",
        "description": "Gestion de l’état utilisateur, connexion/déconnexion, intégration Firebase Auth et configuration du SDK Firebase.",
        "files": [
          "src/context/AuthContext.tsx",
          "src/services/authService.ts",
          "src/firebase/config.ts",
          "src/pages/auth",
          "src/components/auth"
        ]
      },
      {
        "name": "Gestion patients",
        "description": "Pages et composants pour la gestion des patients, lecture/écriture Firestore, cache patient.",
        "files": [
          "src/pages/patients",
          "src/components/patient",
          "src/services/patientService.ts",
          "src/utils/patientCache.ts"
        ]
      },
      {
        "name": "Consultations",
        "description": "Flux de consultations, services associés, synchronisation et migrations liées aux consultations.",
        "files": [
          "src/pages/consultations",
          "src/services/consultationService.ts",
          "src/services/consultationMigrationService.ts",
          "src/services/initialConsultationSyncService.ts",
          "src/services/initialConsultationIntegrityService.ts"
        ]
      },
      {
        "name": "Calendrier et rendez-vous",
        "description": "Composants calendrier et service de gestion des rendez-vous.",
        "files": [
          "src/components/calendar",
          "src/services/appointmentService.ts"
        ]
      },
      {
        "name": "Facturation et factures",
        "description": "Pages de facturation et service de génération/gestion des factures.",
        "files": [
          "src/pages/invoices",
          "src/services/invoiceService.ts"
        ]
      },
      {
        "name": "Tableau de bord",
        "description": "Page Dashboard avec indicateurs et service de données.",
        "files": [
          "src/pages/Dashboard.tsx",
          "src/services/dashboardService.ts"
        ]
      },
      {
        "name": "Téléversement de documents (Storage)",
        "description": "Upload PDF/JPG/PNG vers Firebase Storage, validation fichiers, métadonnées et UI de gestion.",
        "files": [
          "src/utils/documentStorage.ts",
          "src/utils/fileUpload.ts",
          "src/components/ui/DocumentUploadManager.tsx",
          "storage.rules"
        ]
      },
      {
        "name": "Sécurité, chiffrement et conformité HDS",
        "description": "Utilitaires de chiffrement et conformité Hébergement de Données de Santé.",
        "files": [
          "src/utils/encryption.ts",
          "src/utils/hdsCompliance.ts"
        ]
      },
      {
        "name": "Services de synchronisation et migrations",
        "description": "Synchronisations bidirectionnelles, migrations historiques, détection de duplicats, utilitaires d’intégrité.",
        "files": [
          "src/services/bidirectionalSyncService.ts",
          "src/services/dataMigrationService.ts",
          "src/services/duplicateCleanupService.ts",
          "src/services/migrationDetectionService.ts",
          "src/scripts"
        ]
      },
      {
        "name": "Intégration Cloud Functions",
        "description": "Code Functions backend (TypeScript) pour tâches server-side.",
        "files": [
          "functions/src/index.ts",
          "functions/package.json",
          "functions/tsconfig.json"
        ]
      },
      {
        "name": "Style, UI et configuration outil",
        "description": "Styles Tailwind, composants UI, config Vite, Vitest et ESLint.",
        "files": [
          "tailwind.config.js",
          "src/styles/animatedGradient.css",
          "src/components/ui",
          "vite.config.ts",
          "vitest.config.ts",
          "eslint.config.js"
        ]
      },
      {
        "name": "Tests et configuration test",
        "description": "Tests d’intégration/unitaires et setup de test.",
        "files": [
          "tests/integration/patient-consultation.flow.test.ts",
          "tests/sync.initialConsultation.test.ts",
          "tests/validation.consultation.test.ts",
          "src/test/setup.ts"
        ]
      }
    ]
  }
}
